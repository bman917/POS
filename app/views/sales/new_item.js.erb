$('tbody').append("<%=j render 'sales/item_input_row'%>");


var qty_css = '#qty';
var item_id_css = '#item_id';
var item_name_css = '#item_name';
var item_price_css = '#item_price';

//ATTENTION: this need to happen AFTER the item_input_row has been rendered
disable_add_item_button();


//Highlight the row when the focus is on item qty field
//=====================================================
$(qty_css).on('focus', function(event){
  //console.log('sales form qty focus event');
  if(validate_item_autocomplete(item_id_css, item_price_css)) {
    $(this).closest('tr').find('input').addClass('ready_to_save');  
  }
});
$(qty_css).on('focusout', function(event){
  //console.log('salse form qty focusout');
  $(this).closest('tr').find('input').removeClass('ready_to_save');  
});
//=====================================================



$('#item_name').autocomplete({
  minLength: 2,
  source: "<%=json_items_path%>",
  change: function( event, ui) {
    $('#add_item_button').addClass('hide');
  },
  select: function( event, ui ) {
    console.log("autocomplete selected item:" + ui.item.id);
    $(item_id_css).val(ui.item.id);
    console.log("item_id value:" + $(item_id_css).val());
    //$('#item_name').val(ui.item.value);
    $(qty_css).val("");

    //Delay the focus a little bit so the it happens
    //after normal focusing occurs.
    setTimeout(function() {
      $(qty_css).focus(); 
      $('#add_item_button').removeClass('hide');
    }, 100);
    return false;
  }
});

$('#item_name').focus();